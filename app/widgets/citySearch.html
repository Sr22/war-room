<!doctype html>
<html>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<head>
   <!--<title>Clock</title>-->
</head>
<body>
<div class="container">
    <header>
        <h1>City Search</h1>
    </header>
    <section id="fetch">
        <input type="text" id="term" />
        <button id="search">Enter</button>
    </section>
    <section id="city">
        <p id="des"></p>
        <p id="timestamp"></p>
        <p id="date"></p>
    </section>
</div>
</body>

<script>
function myCallback (json) {
    console.log(json)
}
        var placeId='';
        var latitude ='';
        var longitude = '';
        var time ='';
        var arr = [];
        var key1 = 'AIzaSyBErhwJQ6hNNAm2i_VOc2PXPPCgpF9jhd4';
        $("#term").keypress(function() {
                    var city = $("#term").val();
                    var url = 'https://maps.googleapis.com/maps/api/place/autocomplete/json?input=' + city + '&types=(cities)&language=en&key=' + key1;

                    $('#term').on('keydown' , function(event) {


                        if(event.which == 8| event.which==46) {
                            if(city.length == 0) //could fix for more sophisticated clearing system
                            {
                                $('#des').html('');
                            }


                        }
                    });
                    $('#des').html('');
                    $.ajax({
                        url: url,
                        success: function (data) {
                            var obj = JSON.stringify(data);
                            if (city.length==0)
                            {
                                $('#des').html('');
                            }
                            $.each(data.predictions, function (i, val) {
                                //document.getElementById('des').innerHTML = val.description;
                                arr[i]=val.description;
                                placeId = val.place_id;
                                $('#des').html( $('#des').html() + '<br>' + arr[i] );
                                i++;

                            });

                        }
                    })
                }
            );
        $("#search").click(function(){
                    var url2 = 'https://maps.googleapis.com/maps/api/geocode/json?place_id='+placeId+'&key='+key1;
                    $.ajax({
                        url:url2,
                        success: function(data1){
                            latitude = data1.results[0].geometry.location.lat;
                            longitude = data1.results[0].geometry.location.lng;

                            }
                });
                    var url3 = 'http://api.timezonedb.com/v2/get-time-zone?key=WKXE0BXV0YGO&format=json&by=position&lat='+latitude+'&lng='+longitude;

                    $.ajax({
                        url:url3,
                        success: function(data2) {
                            time = data2['timestamp'];// takes the value we want from the json object, ignoring the extra fluff
                            var gmt = data2['gmtOffset'];
                            var daylight = data2['dst'];
                            var timeSet = time-(3600*daylight)+gmt;

                            var date = new Date(timeSet*1000);
                            var hours = date.getHours();
                            var min = '0'+ date.getMinutes();

                                    //new Date(((time+gmt)*1000)-daylight*3600-3600).toString();
                           document.getElementById('date').innerHTML = date;

                }
            });
            })


            </script>
</html>
